xShop_Text_Editor=function(t,e){var n=this;this.parent=t,this.current_text_component=void 0,this.element=$('<div id="xshop-designer-text-editor" class="xshop-options-editor" style="display:block"> </div>').appendTo(this.parent),this.font_selector=$('<select class="text-editor-font-family"></select>').appendTo(this.element);var o=e.designer_tool.options.base_url,i=o,s=e.designer_tool.font_family;$.each(s,function(t,e){$('<option value="'+e+'">'+e+"</option>").appendTo(n.font_selector)}),$(this.font_selector).change(function(t){n.current_text_component.options.font=$(this).val(),n.current_text_component.render(n.designer_tool)}),this.font_size=$('<select class="text-editor-font-size"></select>').appendTo(this.element),$.each(e.designer_tool.pointtopixel,function(t,e){$('<option value="'+e+'">'+t+"</option>").appendTo(n.font_size)}),$(this.font_size).change(function(t){n.current_text_component.options.font_size=$(this).val(),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.text_button_set=$('<div class="btn-group btn-group-xs" role="group" aria-label="Bold/Italic/Underline"></div>').appendTo(this.element),this.text_bold_btn=$('<div class="btn"><span class="glyphicon glyphicon-bold"></span></div>').appendTo(this.text_button_set),this.text_italic_btn=$('<div class="btn"><span class="glyphicon glyphicon-italic"></span></div>').appendTo(this.text_button_set),this.text_underline_btn=$('<div class="btn"><span class="icon-underline"></span></div>').appendTo(this.text_button_set),this.text_strokethrough_btn=$('<div class="btn" style="display:none;"><span class="icon-strike"></span></div>').appendTo(this.text_button_set),this.text_duplicate_btn=$('<div class="btn" title="Duplicate selected text"><span class="icon-docs"></span></div>').appendTo(this.text_button_set),$(this.text_bold_btn).click(function(t){n.current_text_component.options.bold?($(this).removeClass("active"),n.current_text_component.options.bold=!1):($(this).addClass("active"),n.current_text_component.options.bold=!0),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),$(this.text_italic_btn).click(function(t){n.current_text_component.options.italic?($(this).removeClass("active"),n.current_text_component.options.italic=!1):($(this).addClass("active"),n.current_text_component.options.italic=!0),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),$(this.text_underline_btn).click(function(t){n.current_text_component.options.stokethrough=!1,n.current_text_component.options.underline?($(this).removeClass("active"),n.current_text_component.options.underline=!1):($(this).addClass("active"),n.current_text_component.options.underline=!0),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),$(this.text_strokethrough_btn).click(function(t){n.current_text_component.options.underline=!1,n.current_text_component.options.stokethrough?($(this).removeClass("active"),n.current_text_component.options.stokethrough=!1):($(this).addClass("active"),n.current_text_component.options.stokethrough=!0),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.text_duplicate_btn.click(function(t){var e=new Text_Component;e.init(n.current_text_component.designer_tool,n.current_text_component.canvas,n.current_text_component.editor),$.each(n.current_text_component.options,function(t,n){e.options[t]=n}),e.options.movable=!0,e.options.x=5,e.options.y=5,n.current_text_component.designer_tool.pages_and_layouts[n.current_text_component.designer_tool.current_page][n.current_text_component.designer_tool.current_layout].components.push(e),e.render(n.designer_tool)}),this.text_button_set=$('<div class="btn-group btn-group-xs" role="group" aria-label="Text Alignment"></div>').appendTo(this.element),this.text_align_left_btn=$('<div class="btn"><span class="glyphicon glyphicon-align-left"></span></div>').appendTo(this.text_button_set),this.text_align_center_btn=$('<div class="btn"><span class="glyphicon glyphicon-align-center"></span></div>').appendTo(this.text_button_set),this.text_align_right_btn=$('<div class="btn"><span class="glyphicon glyphicon-align-right"></span></div>').appendTo(this.text_button_set),$(this.text_align_left_btn).click(function(){n.current_text_component.options.alignment_left?($(this).removeClass("active"),n.current_text_component.options.alignment_left=!1):($(this).addClass("active"),n.current_text_component.options.alignment_left=!0),$(n.text_align_center_btn).removeClass("active"),n.current_text_component.options.alignment_center=!1,$(n.text_align_justify_btn).removeClass("active"),n.current_text_component.options.alignment_justify=!1,$(n.text_align_right_btn).removeClass("active"),n.current_text_component.options.alignment_right=!1,$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),$(this.text_align_right_btn).click(function(){n.current_text_component.options.alignment_right?($(this).removeClass("active"),n.current_text_component.options.alignment_right=!1):($(this).addClass("active"),n.current_text_component.options.alignment_right=!0),$(n.text_align_left_btn).removeClass("active"),n.current_text_component.options.alignment_left=!1,$(n.text_align_justify_btn).removeClass("active"),n.current_text_component.options.alignment_justify=!1,$(n.text_align_center_btn).removeClass("active"),n.current_text_component.options.alignment_center=!1,$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),$(this.text_align_center_btn).click(function(){n.current_text_component.options.alignment_center?($(this).removeClass("active"),n.current_text_component.options.alignment_center=!1):($(this).addClass("active"),n.current_text_component.options.alignment_center=!0),$(n.text_align_left_btn).removeClass("active"),n.current_text_component.options.alignment_left=!1,$(n.text_align_justify_btn).removeClass("active"),n.current_text_component.options.alignment_justify=!1,$(n.text_align_right_btn).removeClass("active"),n.current_text_component.options.alignment_right=!1,$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.text_button_set=$('<div class="btn-group btn-group-xs" role="group" aria-label="Orderd List"></div>').appendTo(this.element),$(this.text_indent_left_btn).click(function(){n.current_text_component.options.indent_left!=n.current_text_component.options.indent_left,$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.text_button_set=$('<div class="btn-group btn-group-xs" role="group" aria-label="Text Alignment"></div>').appendTo(this.element),this.text_rotate_clockwise_btn=$('<div class="btn"><span class="glyphicon glyphicon-repeat" style="-moz-transform: scaleX(-1);-o-transform: scaleX(-1);-webkit-transform: scaleX(-1);transform: scaleX(-1);filter: FlipH;-ms-filter:FlipH;"></span></div>').appendTo(this.text_button_set),this.text_rotate_anticlockwise_btn=$('<div class="btn"><span class="glyphicon glyphicon-repeat"></span></div>').appendTo(this.text_button_set),this.text_up_down=$('<div class="btn xshop-designer-text-up-down-btn"></div>').appendTo(this.element),this.text_up=$('<span class="xshop-designer-text-up-btn icon-angle-circled-up atk-size-mega xshop-designer-text-up-btn" title="Bring to Front" ></span>').appendTo(this.text_up_down),this.text_down=$('<span class="xshop-designer-text-down-btn icon-angle-circled-down atk-size-mega xshop-designer-text-up-btn" title="Send to Back" ></span>').appendTo(this.text_up_down),this.text_up.click(function(){current_text=$(n.current_text_component.element),current_zindex=current_text.css("z-index"),"auto"==current_zindex&&(current_zindex=0),current_text.css("z-index",parseInt(current_zindex)+1),n.current_text_component.options.zindex=current_text.css("z-index"),$("span.xshop-designer-text-down-btn").hasClass("xepan-designer-button-disable")&&$("span.xshop-designer-text-down-btn").removeClass("xepan-designer-button-disable")}),this.text_down.click(function(){current_text=$(n.current_text_component.element),current_zindex=current_text.css("z-index"),"auto"==current_zindex||parseInt(current_zindex)-1<0?current_zindex=0:current_zindex=parseInt(current_zindex)-1,current_text.css("z-index",current_zindex),n.current_text_component.options.zindex=current_zindex,0==current_zindex&&$("span.xshop-designer-text-down-btn").addClass("xepan-designer-button-disable")}),this.text_color_picker=$('<input id="xshop-colorpicker-full" type="text">').appendTo(this.element),$(this.text_color_picker).colorpicker({parts:"full",alpha:!1,showOn:"both",buttonColorize:!0,showNoneButton:!0,buttonImage:"vendor/xepan/commerce/templates/css/tool/designer/images/ui-colorpicker.png",ok:function(t,e){n.current_text_component.options.color_cmyk=parseInt(100*e.cmyk.c)+","+parseInt(100*e.cmyk.m)+","+parseInt(100*e.cmyk.y)+","+parseInt(100*e.cmyk.k),n.current_text_component.options.color_formatted="#"+e.formatted,n.current_text_component.render(n.designer_tool),$(".xshop-designer-tool").xepan_xshopdesigner("check")}}),this.text_remove=$('<div class="btn"><span class="glyphicon glyphicon-trash"></span></div>').appendTo(this.element),this.text_remove.click(function(){dt=n.current_text_component.designer_tool,$.each(dt.pages_and_layouts[dt.current_page][dt.current_layout].components,function(t,e){e===dt.current_selected_component&&($(dt.current_selected_component.element).remove(),dt.pages_and_layouts[dt.current_page][dt.current_layout].components.splice(t,1),dt.current_selected_component=null,dt.canvasObj.getActiveObject().remove(),dt.option_panel.hide())})}),this.editor_close_btn=$('<div class="xshop-designer-tool-editor-option-close"><i class="atk-box atk-box-small pull-right glyphicon glyphicon-remove"></i></div>').appendTo(this.element),this.editor_close_btn.click(function(t){n.element.hide()}),div=$('<div class="xshop-designer-text-input-outer-div" ></div>').appendTo(this.element),this.text_input=$('<textarea class="xshop-designer-text-input" rows="1"></textarea>').appendTo(div),$(this.text_input).delayKeyup(function(t){n.current_text_component.options.text=$(t).val(),n.current_text_component.designer_tool.options.designer_mode&&(n.current_text_component.options.default_value=$(t).val()),n.current_text_component.options.text=$(t).val(),n.current_text_component.render(n.designer_tool)},10),this.row1=$('<div class="atk-row xshop-designer-tool-editing-helper text" style="display:block;margin:0;"> </div>').appendTo(this.element),this.text_x_label=$('<div class="atk-move-left"><label for="xshop-designer-text-positionx">x: </label></div>').appendTo(this.row1),this.text_x=$('<input name="x" id="xshop-designer-text-positionx" class="xshop-designer-text-inputx"  />').appendTo(this.text_x_label),$(this.text_x).change(function(){n.current_text_component.options.x=$(this).val(),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.text_y_label=$('<div class="atk-move-left"><label for="xshop-designer-text-positiony">y: </label></div>').appendTo(this.row1),this.text_y=$('<input name="y" id="xshop-designer-text-positiony" class="xshop-designer-text-inputy"  />').appendTo(this.text_y_label),$(this.text_y).change(function(){n.current_text_component.options.y=$(this).val(),$(".xshop-designer-tool").xepan_xshopdesigner("check"),n.current_text_component.render(n.designer_tool)}),this.setTextComponent=function(t){this.current_text_component=t,$(this.font_size).val(t.options.font_size),$(this.font_selector).val(t.options.font),$(this.text_color_picker).val(t.options.color_formatted),$(this.text_color_picker).colorpicker("setColor",t.options.color_formatted),this.current_text_component.options.colorable||this.text_color_picker.next("button").hide(),this.text_input.val(this.current_text_component.options.text),this.current_text_component.options.editable||this.text_input.hide(),1==t.options.alignment_center?$(this.text_align_center_btn).addClass("active"):$(this.text_align_center_btn).removeClass("active"),1==t.options.alignment_left?$(this.text_align_left_btn).addClass("active"):$(this.text_align_left_btn).removeClass("active"),1==t.options.alignment_right?$(this.text_align_right_btn).addClass("active"):$(this.text_align_right_btn).removeClass("active"),1==t.options.bold?$(this.text_bold_btn).addClass("active"):$(this.text_bold_btn).removeClass("active"),1==t.options.italic?$(this.text_italic_btn).addClass("active"):$(this.text_italic_btn).removeClass("active"),1==t.options.underline?$(this.text_underline_btn).addClass("active"):$(this.text_underline_btn).removeClass("active"),1==t.options.stokethrough?$(this.text_stokethrough_btn).addClass("active"):$(this.text_stokethrough_btn).removeClass("active")}},Text_Component=function(t){this.parent=void 0,this.designer_tool=void 0,this.canvas=void 0,this.element=void 0,this.editor=void 0,this.xhr=void 0,this.options={x:0,y:0,width:"100",height:"100",text:"Enter Text",font:"OpenSans",font_size:"12",color_cmyk:"0,0,0,100",color_formatted:"#000000",bold:!1,italic:!1,underline:!1,stokethrough:!1,rotation_angle:0,locked:!1,alignment_left:!1,alignment_center:!1,alignment_right:!1,alignment_justify:!0,movable:!0,colorable:!0,editable:!0,default_value:"Enter Text",zindex:0,resizable:!0,auto_fit:!1,frontside:!0,backside:!1,multiline:!1,type:"Text",base_url:void 0,page_url:void 0},this.init=function(t,e,n){this.designer_tool=t,this.canvas=e,void 0!==n&&(this.editor=n),this.options.base_url=t.options.base_url,this.options.page_url=t.options.base_url},this.renderTool=function(t){var e=this;this.parent=t,tool_btn=$('<div class="btn btn-deault"><i class="glyphicon glyphicon-text-height"></i><br>Text</div>').appendTo(t.find(".xshop-designer-tool-topbar-buttonset")),this.editor=new xShop_Text_Editor(t.find(".xshop-designer-tool-topbar-options"),e),tool_btn.click(function(t){e.designer_tool.current_selected_component=void 0;var n=new Text_Component;n.init(e.designer_tool,e.canvas,e.editor),e.designer_tool.pages_and_layouts[e.designer_tool.current_page][e.designer_tool.current_layout].components.push(n),n.render(e.designer_tool)})},this.render=function(t){var e=this;if(t&&(e.designer_tool=t),this.element)return this.element.set({text:e.options.text,left:e.options.x*e.designer_tool._getZoom(),top:e.options.y*e.designer_tool._getZoom(),width:e.options.width*e.designer_tool._getZoom(),fontSize:e.options.font_size,fontFamily:e.options.font,fontWeight:e.options.bold?"bold":"normal",textDecoration:e.options.underline?"underline":e.options.stokethrough?"line-through":null,lockUniScaling:!0,scaleX:e.designer_tool._getZoom(),scaleY:e.designer_tool._getZoom(),fill:e.options.color_formatted,textAlign:e.options.alignment_right?"right":e.options.alignment_center?"center":e.options.alignment_justify?"justify":"left",fontStyle:e.options.italic?"italic":"normal",angle:e.options.rotation_angle}),void e.designer_tool.canvasObj.renderAll();void 0==e.options.base_url&&(e.options.base_url=e.designer_tool.options.base_url,e.options.page_url=e.designer_tool.options.base_url);var n=new fabric.Text(e.options.text,{left:e.options.x*e.designer_tool._getZoom(),top:e.options.y*e.designer_tool._getZoom(),width:e.options.width*e.designer_tool._getZoom(),fontSize:e.options.font_size,fontFamily:e.options.font,fontWeight:e.options.bold?"bold":"normal",textDecoration:e.options.underline?"underline":e.options.stokethrough?"line-through":null,scaleX:e.designer_tool._getZoom(),scaleY:e.designer_tool._getZoom(),fill:e.options.color_formatted,textAlign:"left",fontStyle:e.options.italic?"italic":"normal",angle:e.options.rotation_angle,lockScalingX:!0,lockScalingY:!0});return n.on("selected",function(t){$(".xshop-options-editor").hide(),e.editor.element.show(),e.designer_tool.option_panel.fadeIn(500),$(".xshop-designer-text-input").select(),e.designer_tool.option_panel.css("z-index",7e3),e.designer_tool.option_panel.addClass("xshop-text-options"),e.designer_tool.option_panel.offset({top:e.designer_tool.canvasObj._offset.top+n.top-e.designer_tool.option_panel.height(),left:e.designer_tool.canvasObj._offset.left+n.left}),e.designer_tool.options.designer_mode?(e.editor.text_x.val(e.options.x),e.editor.text_y.val(e.options.y)):(e.editor.text_x.hide(),e.editor.text_x_label.hide(),e.editor.text_y.hide(),e.editor.text_y_label.hide()),e.editor.setTextComponent(e),e.designer_tool.options.designer_mode&&(e.designer_tool.freelancer_panel.FreeLancerComponentOptions.element.show(),e.designer_tool.freelancer_panel.setComponent($(this).data("component"))),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,0==e.options.zindex?$("span.xshop-designer-text-down-btn").addClass("xepan-designer-button-disable"):$("span.xshop-designer-text-down-btn").removeClass("xepan-designer-button-disable")}),e.designer_tool.canvasObj.add(n),this.element=n,this.element.component=e,void e.designer_tool.canvasObj.renderAll();void 0==this.element?(this.element=$('<div style="position:absolute" class="xshop-designer-component"><span><img></img></span></div>').appendTo(this.canvas),this.element.draggable({containment:e.designer_tool.safe_zone,smartguides:".xshop-designer-component",tolerance:5,stop:function(t,n){var o=n.position;e.options.x=e.designer_tool.screen2option(o.left),e.options.y=e.designer_tool.screen2option(o.top)}}).resizable({containment:"parent",handles:"e",autoHide:!0,stop:function(t,n){e.options.width=e.designer_tool.screen2option(n.size.width),e.render()}}),e.options.movable||e.element.draggable("disable"),e.options.colorable||e.editor.text_color_picker.next("button").hide(),e.options.editable||e.editor.text_input.hide(),e.options.resizable||e.element.resizable("disable"),$(this.element).data("component",e),$(this.element).click(function(t){$(".ui-selected").removeClass("ui-selected"),$(this).addClass("ui-selected"),$(".xshop-options-editor").hide(),e.editor.element.show(),e.designer_tool.option_panel.fadeIn(500),$(".xshop-designer-text-input").select(),e.designer_tool.current_selected_component=e,e.designer_tool.option_panel.css("z-index",70),e.designer_tool.option_panel.addClass("xshop-text-options"),top_value=parseInt($(this).offset().top)-parseInt($("#xshop-designer-text-editor").height()+10),e.designer_tool.option_panel.offset({top:top_value,left:$(this).offset().left}),e.designer_tool.options.designer_mode?(e.editor.text_x.val(e.options.x),e.editor.text_y.val(e.options.y)):(e.editor.text_x.hide(),e.editor.text_x_label.hide(),e.editor.text_y.hide(),e.editor.text_y_label.hide()),e.editor.setTextComponent(e),e.designer_tool.options.designer_mode&&(e.designer_tool.freelancer_panel.FreeLancerComponentOptions.element.show(),e.designer_tool.freelancer_panel.setComponent($(this).data("component"))),t.stopPropagation(),0==e.options.zindex?$("span.xshop-designer-text-down-btn").addClass("xepan-designer-button-disable"):$("span.xshop-designer-text-down-btn").removeClass("xepan-designer-button-disable")})):this.element.show(),this.element.css("top",e.options.y*e.designer_tool.zoom),this.element.css("left",e.options.x*e.designer_tool.zoom),void 0!=this.xhr&&this.xhr.abort(),this.xhr=$.ajax({url:"index.php?page=xepan_commerce_designer_rendertext&cut_page=1",type:"GET",data:{default_value:e.options.default_value,text:e.options.text,color:e.options.color_formatted,font:e.options.font,font_size:e.options.font_size,bold:e.options.bold,italic:e.options.italic,underline:e.options.underline,rotation_angle:e.options.rotation_angle,alignment_left:e.options.alignment_left,alignment_right:e.options.alignment_right,alignment_center:e.options.alignment_center,alignment_justify:e.options.alignment_justify,zoom:e.designer_tool.zoom,stokethrough:e.options.stokethrough,width:e.options.width,zindex:e.options.zindex}}).done(function(t){e.element.find("img").attr("src","data:image/png;base64, "+t),e.xhr=void 0,place_in_center===!0&&window.setTimeout(function(){e.options.x=e.element.css("left").replace("px","")/e.designer_tool.zoom,e.options.y=e.element.css("top").replace("px","")/e.designer_tool.zoom},200)}).fail(function(t){console.log("Text Error")}).always(function(){console.log("complete")})}};